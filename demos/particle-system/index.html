<html lang="en">
   <head>
      <meta charset="utf-8">

      <title>Particle system</title>

      <link rel="stylesheet" href="http://benvanik.github.io/WebGL-Inspector/core/lib/gli.all.css">

      <!--
      <script src="http://benvanik.github.io/WebGL-Inspector/core/lib/gli.all.js"></script>
      <script src="http://benvanik.github.io/WebGL-Inspector/core/embed.js"></script>
      -->
   </head>

   <body style="margin:0;background:#222;position:relative;overflow:hidden">
      <canvas></canvas>

      <script src="../../dist/four.js"></script>

      <script class="renderer" type="x-shader/x-vertex">
         #version 100

         precision mediump int;
         precision mediump float;

         @use Camera;

         attribute vec3 a_position;

         uniform Camera u_camera;

         void main()
         {
            gl_Position = u_camera.projectionMatrix * u_camera.modelViewMatrix * vec4(a_position, 1);

            gl_PointSize = 5.0;
         }
      </script>

      <script class="renderer" type="x-shader/x-fragment">
         #version 100

         precision mediump int;
         precision mediump float;

         void main()
         {
            gl_FragColor = vec4(1);
         }
      </script>

      <script>
         'use strict';

         function particularise(point)
         {
            return new Four.Particle({ position: point });
         }

         function solve(solver, mesh)
         {
            solver.solve();

            mesh.update(solver.vertices());
         }

         var program = new Four.Program({ selector: '.renderer' });
         var points = [
            [-2.999975, 0, 2.999975],
            [2.999975, 0, 2.999975],
            [-2.999975, 0, -2.999975],
            [2.999975, 0, -2.999975],
            [0, 0, 2.999975],
            [-2.999975, 0, 0],
            [0, 0, -2.999975],
            [2.999975, 0, 0],
            [0, 0, 0],
            [1.499987, 0, 2.999975],
            [-2.999975, 0, 1.499987],
            [-1.499987, 0, -2.999975],
            [2.999975, 0, -1.499987],
            [-1.499987, 0, 2.999975],
            [-2.999975, 0, -1.499987],
            [1.499987, 0, -2.999975],
            [2.999975, 0, 1.499987],
            [0, 0, 1.499987],
            [0, 0, -1.499987],
            [1.499987, 0, 0],
            [-1.499987, 0, 0],
            [-1.499987, 0, 1.499987],
            [1.499987, 0, 1.499987],
            [1.499987, 0, -1.499987],
            [-1.499987, 0, -1.499987],
            [2.249981, 0, 2.999975],
            [-2.999975, 0, 2.249981],
            [-2.249981, 0, -2.999975],
            [2.999975, 0, -2.249981],
            [-0.749994, 0, 2.999975],
            [-2.999975, 0, -0.749994],
            [0.749994, 0, -2.999975],
            [2.999975, 0, 0.749994],
            [0, 0, 2.249981],
            [0, 0, -0.749994],
            [2.249981, 0, 0],
            [-0.749994, 0, 0],
            [0.749994, 0, 2.999975],
            [-2.999975, 0, 0.749994],
            [-0.749994, 0, -2.999975],
            [2.999975, 0, -0.749994],
            [-2.249981, 0, 2.999975],
            [-2.999975, 0, -2.249981],
            [2.249981, 0, -2.999975],
            [2.999975, 0, 2.249981],
            [0, 0, 0.749994],
            [0, 0, -2.249981],
            [0.749994, 0, 0],
            [-2.249981, 0, 0],
            [-1.499987, 0, 2.249981],
            [-1.499987, 0, 0.749994],
            [-0.749994, 0, 1.499987],
            [-2.249981, 0, 1.499987],
            [1.499987, 0, 2.249981],
            [1.499987, 0, 0.749994],
            [2.249981, 0, 1.499987],
            [0.749994, 0, 1.499987],
            [1.499987, 0, -0.749994],
            [1.499987, 0, -2.249981],
            [2.249981, 0, -1.499987],
            [0.749994, 0, -1.499987],
            [-1.499987, 0, -0.749994],
            [-1.499987, 0, -2.249981],
            [-0.749994, 0, -1.499987],
            [-2.249981, 0, -1.499987],
            [-2.249981, 0, 2.249981],
            [0.749994, 0, 2.249981],
            [0.749994, 0, -0.749994],
            [-2.249981, 0, -0.749994],
            [-0.749994, 0, 2.249981],
            [-0.749994, 0, 0.749994],
            [-2.249981, 0, 0.749994],
            [2.249981, 0, 2.249981],
            [2.249981, 0, 0.749994],
            [0.749994, 0, 0.749994],
            [2.249981, 0, -0.749994],
            [2.249981, 0, -2.249981],
            [0.749994, 0, -2.249981],
            [-0.749994, 0, -0.749994],
            [-0.749994, 0, -2.249981],
            [-2.249981, 0, -2.249981]
         ];
         var particles = points.map(particularise);
         var solver = new Four.ParticleSystem({ particles: particles, solver: 'SIMPLECTIC', timestep: 0.0001 });
         var view = new Four.Framebuffer();
         var camera = new Four.PerspectiveCamera();
         var scene = new Four.Scene();
         var material = new Four.Material();
         var mesh = new Four.Mesh({ vertices: points, usage: 'DYNAMIC_DRAW', primitive: 'POINTS', material: material });

         scene.put(mesh);

         scene.use(program);

         scene.animate(view, camera, function()
         {
            solve(solver, mesh);
         });
      </script>
   </body>
</html>